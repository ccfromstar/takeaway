<% include header %>
<h1>1.库存查询(可选门店、分类和材料分类)</h1>
<table class="form">
	<tr>
		<td>
			<input type="text" id="k_store" list="list3" value="<%=k_store%>" onblur="setCat(1);" />
			<datalist id="list3">
					<%for(var i in obj5){%>
						<option value="<%=obj5[i].name%>">
							<%=obj5[i].name%>
						</option>
					<%}%>
				</datalist>
		</td>
		<td>
			<input type="text" id="k_category" list="list2" value="<%=k_cate%>" />
			<datalist id="list2">
					<%for(var i in obj3){%>
						<option value="<%=obj3[i].name%>">
					<%}%>
				</datalist>
		</td>
		<td>
			<input type="text" id="cate_id" placeholder="所属分类" value="<%=k_no%>" list="mlist" />
			<datalist id="mlist">
					<%for(var i in obj4){%>
						<option value="<%=obj4[i].no%>">
							<%=obj4[i].name%>
						</option>
						<%}%>
				</datalist>
		</td>
		<td>
			<input type="text" id="name" placeholder="材料名称" value="<%=k_n%>" list="mlist1" />
			<datalist id="mlist1">
					<%for(var i in obj6){%>
						<option value="<%=obj6[i].no+"."+obj6[i].name%>">
					<%}%>
				</datalist>
			<input type="text" id="s_name" placeholder="材料名检索" onblur="filtermlist()" />
		</td>
		<td>
			<button class="btn btn-xs" onclick="getDate()">筛选</button>
			<button class="btn btn-xs" onclick="window.location='/erp/stock?p=所有&s=所有';">查看全部</button>
			<button class="btn btn-xs" onclick="toExcel()">导出Excel</button>
		</td>
	</tr>
</table>
<div class="div_auto">
	<table class="table table-hover table-bordered">
		<tr>
			<th>门店</th>
			<th>分类</th>
			<th>材料名称</th>
			<th>单价</th>
			<th>单位</th>
			<th>库存数</th>
		</tr>
		<%for(var i in obj2){%>
		<tr>
			<td>
				<%=obj2[i].store%>
			</td>
			<td>
				<%=obj2[i].category%>
			</td>
			<td>
				<%=obj2[i].no%>.
				<%=obj2[i].name%>
			</td>
			<td>
				<%=obj2[i].unitPrice%>
			</td>
			<td>
				<%=obj2[i].unit%>
			</td>
			<%if(obj2[i].num < 10){%>
			<td style="background:#FF2F2F;color:#fff">
				<%=obj2[i].num%>
			</td>
			<%}else{%>
			<td>
				<%=obj2[i].num%>
			</td>
			<%}%>
		</tr>
		<%}%>
	</table>
</div>
<script>
	function getDate() {
		window.location = "/erp/stock?p=" + $('#k_category').val() + "&q=" + $('#cate_id').val() + "&s=" + $('#k_store').val()+"&n=" + $('#name').val();
	}
	/*导出采购单Excel表*/
	function toExcel() {
		$.ajax({
			type: "POST",
			url: "/erp/toExcelstock",
			data: {
				k_store: $('#k_store').val(),
				k_category: $("#k_category").val()
			},
			success: function(data) {
				window.open("/excelop/temp/" + data);
			}
		});
	}

	/*根据名店加载分类*/
	function setCat(i) {
		if(i == 1) {
			var h = '';
			<%for(var i in obj3){%>
			if('<%=obj3[i].sname%>' == $('#k_store').val()) {
				h += '<option value="<%=obj3[i].name%>"><%=obj3[i].name%></option>';
			}
			<%}%>
			$('#list2').html(h);
		}
	}
	
	function filtermlist(){
		var v = $('#s_name').val();
		var html = '';
		<%for(var i in obj6){%>
		var n = '<%=obj6[i].name%>';
		if(n.indexOf(v) != -1){
			html += '<option value="<%=obj6[i].no+"."+obj6[i].name%>">';
		}			
		<%}%>
		$('#mlist1').html(html);
	}
</script>
<% include footer %>