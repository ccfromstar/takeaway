(function(){var F=(function(){var I=0;var G=function(){if(I===0){throw new Error("Execute too soon.")}return I};var J={};try{Object.defineProperty(J,"value",{get:G});I=1;return J.value===1}catch(H){return false}})();var h,E;var m={};var n="670a1076-712b-4edd-9b70-64b152fe1cd9";var s=function(G){return G._typeId==n};var i=m.CanceledError=function(){};i.prototype={isTypeOf:s,_typeId:n,message:"The task has been cancelled."};var k="4a73efb8-c2e2-4305-a05c-72385288650a";var c=m.AggregateError=function(H){this.children=[];if(H){for(var G=0;G<H.length;G++){this.children.push(H[G])}}};c.prototype={_typeId:k,message:"This is an error contains sub-errors, please check the 'children' collection for more details.",isTypeOf:function(G){return G._typeId==k}};var e=m.CancellationToken=function(){};e.prototype={register:function(G){if(this.isCancellationRequested){G()}if(!this._handlers){this._handlers=[]}this._handlers.push(G)},unregister:function(H){if(!this._handlers){return}var G=this._handlers.indexOf(H);if(G>=0){this._handlers.splice(G,1)}},cancel:function(){if(this.isCancellationRequested){return}this.isCancellationRequested=true;var G=this._handlers;delete this._handlers;for(var I=0;I<G.length;I++){try{G[I]()}catch(H){h.logger.warn("Cancellation handler threw an error: "+H)}}},throwIfCancellationRequested:function(){if(this.isCancellationRequested){throw new i()}}};var y=function(){this._listeners={};this._firing=null};y.prototype={add:function(H,I){if(this._firing===H){var G=this;setTimeout(function(){G.add(H,I)},0);return}var J=this._listeners[H];if(!J){J=this._listeners[H]=[]}J.push(I)},remove:function(I,J){if(this._firing===I){var G=this;setTimeout(function(){G.remove(I,J)},0);return}var K=this._listeners[I];if(!K){return}var H=K.indexOf(J);if(H>=0){K.splice(H,1)}},fire:function(I,G,H){var L=this._listeners[I];if(!L){return}this._firing=I;for(var K=0;K<L.length;K++){try{L[K].call(G,H)}catch(J){h.logger.warn('An error occurred in "'+I+' listener": '+J)}}this._firing=null}};var f=new y();var a=m.Task=function(G){this._delegate=G;this._eventManager=new y();this.status="ready"};a.prototype={start:function(){if(this.status!="ready"){throw new Error('Task can only be started in "ready" status.')}this.status="running";try{this._delegate(this)}catch(G){if(this.status=="running"){this.complete("failure",G)}else{h.logger.warn("An unexpected error occurred after the task is completed: "+G)}}return this},complete:function(I,J){if(I!=="success"&&I!=="failure"){throw new Error("Unsupported type: "+I)}if(this.status!="running"){throw new Error('The "complete" method can only be called in "running" status.')}var H=this._eventManager;this._eventManager=null;if(I==="success"){this.status="succeeded";if(F){this._result=J}else{this.result=J}H.fire("success",this)}else{if(s(J)){this.status="canceled"}else{this.status="faulted"}if(F){this._error=J}else{this.error=J}H.fire("failure",this)}H.fire("complete",this);if(I!=="failure"){return}if(!F){return}if(this._errorObserved){return}var G=this;this._unobservedTimeoutToken=setTimeout(function(){G._handleUnobservedError(J)},a.unobservedTimeout)},observeError:function(){if(this.status==="ready"||this.status==="running"){throw new Error("The method could only be called when it's completed.")}if(!F){return this.error}var G=this._unobservedTimeoutToken;if(G){clearTimeout(G);this._unobservedTimeoutToken=null}this._errorObserved=true;return this._error},_handleUnobservedError:function(H){this._unobservedTimeoutToken=null;var G={task:this,error:H,observed:false};f.fire("unobservedError",a,G);if(!G.observed){throw H}},then:function(H){var G=this;return a.create(function(K){var J=function(){if(this.error){K.complete("failure",this.error)}else{K.complete("success",this.result)}};var L=function(M){if(M.status=="ready"){M.start()}if(M.status=="running"){M.on("complete",J)}else{J.call(M)}};var I=function(){if(this.error){return K.complete("failure",this.error)}var N;try{N=H(this.result)}catch(M){return K.complete("failure",M)}L(N)};if(G.status=="ready"){G.start()}if(G.status=="running"){G.on("complete",I)}else{I.call(G)}})}};a.prototype.on=a.prototype.addEventListener=function(){var G=this._eventManager;if(!G){throw new Error("Cannot add event listeners when the task is complete.")}G.add.apply(G,arguments);return this};a.prototype.off=a.prototype.removeEventListener=function(){var G=this._eventManager;if(!G){throw new Error("All the event listeners have been removed when the task was complete.")}G.remove.apply(G,arguments);return this};if(F){Object.defineProperty(a.prototype,"error",{get:function(){return this.observeError()}});Object.defineProperty(a.prototype,"result",{get:function(){var G=this.observeError();if(G){throw G}return this._result}})}var u=function(){this.observeError()};a.on=a.addEventListener=function(){f.add.apply(f,arguments)};a.off=a.removeEventListener=function(G,H){f.remove.apply(f,arguments)};a.unobservedTimeout=10*1000;var x=a.isTask=function(G){return G&&(typeof G.start==="function")&&(typeof G.addEventListener)==="function"&&(typeof G.removeEventListener)==="function"&&(typeof G.complete)==="function"};var j=a.create=function(G){return new a(G)};var p=a.whenAll=function(){var H;if(arguments.length==1){var G=arguments[0];if(x(G)){H=[G]}else{H=G}}else{H=new Array(arguments.length);for(var I=0;I<arguments.length;I++){H[I]=arguments[I]}}return j(function(L){var M;var J=function(){if(M){L.complete("failure",new c(M))}else{var N=E.map(H,function(O){return O.result});L.complete("success",N)}};var K=0;E.each(H,function(O,N){if(!N){return}if(!x(N)){H[O]=N=p(N)}if(N.status==="ready"){N.start()}if(N.status==="running"){K++;N.addEventListener("complete",function(){if(this.status!=="succeeded"){if(!M){M=[]}M.push(this.error)}if(--K==0){J()}})}else{if(N.status==="faulted"||N.status==="canceled"){if(!M){M=[]}M.push(N.error)}}});if(K==0){J()}})};var b=a.whenAny=function(){var K={};var H=true;if(arguments.length==1){var G=arguments[0];if(x(G)){K[0]=G}else{H=E.isArray(G);E.each(G,function(N,M){if(x(M)){K[N]=M}})}}else{for(var L=0;L<arguments.length;L++){var I=arguments[L];if(x(I)){K[L]=I}}}var J=H?function(M){return parseInt(M,10)}:function(M){return M};return j(function(O){if(E.isEmpty(K)){return O.complete("failure","There's no valid input tasks.")}var M;E.each(K,function(Q,P){if(P.status==="ready"){P.start()}if(P.status!=="running"){P.observeError();if(!M){M={key:J(Q),task:P}}}});if(M){E.each(K,function(Q,P){if(P.status==="running"){P.on("failure",u)}});return O.complete("success",M)}var N=function(){this.observeError();var Q=this;var P;E.each(K,function(S,R){if(Q===R){P=S;return}R.off("complete",N);R.on("failure",u)});O.complete("success",{key:J(P),task:this})};E.each(K,function(P){P.addEventListener("complete",N)})})};var A=m.sleep=function(G,H){return a.create(function(J){if(H&&H.isCancellationRequested){J.complete("failure",new i())}var I;var K;if(H){K=function(){clearTimeout(I);J.complete("failure",new i())}}var I=setTimeout(function(){if(H){H.unregister(K)}J.complete("success")},G);if(H){H.register(K)}})};var g=m.onEvent=function(I,G,H){return a.create(function(K){if(H&&H.isCancellationRequested){K.complete("failure",new i())}var M=function(){if(I.removeEventListener){I.removeEventListener(G,J)}else{if(I.removeListener){I.removeListener(G,J)}else{I.detachEvent(G,J)}}};var J;var L;if(H){L=function(){M();K.complete("failure",new i())}}var J=function(N){if(H){H.unregister(L)}M();K.complete("success",N)};if(I.addEventListener){I.addEventListener(G,J)}else{if(I.addListener){I.addListener(G,J)}else{I.attachEvent(G,J)}}if(H){H.register(L)}})};var D=m.AsyncBuilder=function(){};D.prototype={m:function(H,G){return a.create(function(I){G.next(H,function(J,K,L){if(J=="normal"||J=="return"){I.complete("success",K)}else{if(J=="throw"){I.complete("failure",K)}else{throw new Error("Unsupported type: "+J)}}})})},n:function(G,H){return{next:function(K,J){var I=function(){if(this.error){J("throw",this.error)}else{var M;try{M=H.call(K,this.result)}catch(L){J("throw",L);return}M.next(K,J)}};if(G.status=="ready"){G.addEventListener("complete",I);G.start()}else{if(G.status=="running"){G.addEventListener("complete",I)}else{I.call(G)}}}}}};var d=m.Binding={};var z=function(H,J){var G=[];for(var I=0;I<H.length;I++){G.push(H[I])}while(G.length<J){G.push(undefined)}return G};var r=function(H){if(H.length<=1){return null}var G=[];for(var I=1;I<H.length;I++){G.push(H[I])}return G};var o=d.fromStandard=function(H){var G=r(arguments);return function(){var J=this;var I=z(arguments,H.length-1);return a.create(function(K){I.push(function(M,L){if(M){K.complete("failure",M)}else{if(!G){K.complete("success",L)}else{var O={};for(var N=0;N<G.length;N++){O[G[N]]=arguments[N+1]}return K.complete("success",O)}}});H.apply(J,I)})}};var C=d.fromCallback=function(H){var G=r(arguments);return function(){var J=this;var I=z(arguments,H.length-1);return a.create(function(K){I.push(function(L){if(G){var N={};for(var M=0;M<G.length;M++){N[G[M]]=arguments[M]}K.complete("success",N)}else{K.complete("success",L)}});H.apply(J,I)})}};var B=!!(typeof require==="function"&&typeof module!=="undefined"&&module.exports);var w=!!(typeof require==="function"&&typeof define==="function"&&define.amd);var v=function(){h.define({name:"async",version:"0.7.1",require:B&&require,autoloads:["builderbase"],dependencies:{builderbase:"~0.7.0"},init:function(){E=h._;E.each(h.BuilderBase.prototype,function(G,H){D.prototype[G]=H});h.Async=m;h.binders.async="$await";h.builders.async=new D();h.b=h.builders}})};if(B){try{h=require("./wind-core")}catch(t){h=require("wind-core")}v()}else{if(w){require(["wind-core"],function(G){h=G;v()})}else{var l=Function,q=l("return this")();if(!q.Wind){throw new Error('Missing the root object, please load "wind" component first.')}h=q.Wind;v()}}})();